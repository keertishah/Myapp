{"ast":null,"code":"import _classCallCheck from \"/Users/ktshah/workspacek/mclinical/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/ktshah/workspacek/mclinical/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/ktshah/workspacek/mclinical/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/ktshah/workspacek/mclinical/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/ktshah/workspacek/mclinical/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/ktshah/workspacek/mclinical/src/App.js\";\nimport React, { Component } from 'react';\nimport Amplify, { Storage } from 'aws-amplify';\nimport { message, Button, Icon, Alert } from 'antd';\nimport awsmobile from './aws-exports';\nimport Progress from './component/Progress'; //import BadResult from './component/BadResult';\n//import GoodResult from './component/GoodResult';\n\nimport MedicalForm from './component/MedicalForm';\nimport './App.css';\nAmplify.configure(awsmobile);\nAmplify.Logger.LOG_LEVEL = 'INFO';\nvar APPLICATION_TIMEOUT = 8000; // In milliseconds\n\nvar UPLOAD_S3_PREFIX = \"uploads\";\nvar DOWNLOAD_S3_PREFIX = \"results\";\nvar STATUS = {\n  WELCOME: \"Welcome page\",\n  KEEP_IMAGE_USER_DECISION: \"Keep image user decision\",\n  TAKE_SHOT: \"Take shot\",\n  LOADING: \"Loading\",\n  WAITING_FOR_PROCESSING: \"Wait image to be processed\",\n  DISPLAY_GOOD_RESULT: \"Display good news\",\n  DISPLAY_BAD_RESULT: \"Display bad news\",\n  NO_CAMERA_DETECTED: \"No camera on device\",\n  NO_FACE_DETECTED: \"No face detected\",\n  IMAGE_DOWNLOADED: \"Result image was downloaded by user\",\n  BACKEND_TIMEOUT: \"Backend was too long to answer\",\n  FILL_FORM: \"User is filling the form\"\n};\nvar CAMERA = {\n  REAR: \"rear cam\",\n  FRONT: \"front cam\",\n  SINGLE: \"there is only one cam\"\n};\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App() {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(App).call(this));\n    _this.waittime = 0;\n    _this.videoRef = React.createRef();\n    _this.canvasRef = React.createRef();\n    _this.containerRef = React.createRef();\n    _this.sendsound = new Audio(\"/sounds/send.mp3\");\n    _this.deletesound = new Audio(\"/sounds/trash.mp3\");\n    _this.shotsound = new Audio(\"/sounds/takeshot.mp3\");\n    _this.processound = new Audio(\"/sounds/processing.mp3\");\n\n    _this.processound.addEventListener('ended', function () {\n      this.currentTime = 0;\n      this.play();\n    }, false);\n\n    _this.state = {\n      stream: null,\n      camera: CAMERA.SINGLE,\n      fullscreen: false,\n      processedImage: null,\n      filePrefix: \"\",\n      status: STATUS.WELCOME\n    };\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      Storage.configure({\n        level: 'private'\n      });\n    }\n  }, {\n    key: \"ignoreImage\",\n    value: function ignoreImage() {\n      this.deletesound.play();\n      this.returnToCapture();\n    }\n  }, {\n    key: \"returnToCapture\",\n    value: function returnToCapture() {\n      message.warning('Take a clear picture of your face, mouth open, tongue outside.', 2);\n      this.setState({\n        stream: this.state.stream,\n        camera: this.state.camera,\n        fullscreen: this.state.fullscreen,\n        processedImage: this.state.processedImage,\n        filePrefix: this.state.filePrefix,\n        status: STATUS.TAKE_SHOT\n      });\n    }\n  }, {\n    key: \"uploadImage\",\n    value: function uploadImage(image) {\n      var _this2 = this;\n\n      var filename = Date.now();\n      Storage.put(UPLOAD_S3_PREFIX + '/' + filename + '.png', image, {\n        contentType: 'image/png'\n      }).then(function (result) {\n        console.log(\"upload done\");\n\n        _this2.setState({\n          stream: _this2.state.stream,\n          camera: _this2.state.camera,\n          fullscreen: _this2.state.fullscreen,\n          processedImage: _this2.state.processedImage,\n          filePrefix: filename,\n          status: _this2.state.status\n        });\n\n        _this2.waitForImageFromBackend();\n      }).catch(function (err) {\n        return console.error(err);\n      });\n    }\n  }, {\n    key: \"sendDataToBackend\",\n    value: function sendDataToBackend() {\n      this.processound.play();\n      this.setState({\n        stream: this.state.stream,\n        camera: this.state.camera,\n        fullscreen: this.state.fullscreen,\n        processedImage: this.state.processedImage,\n        filePrefix: this.state.processedImage,\n        status: STATUS.WAITING_FOR_PROCESSING\n      });\n      this.canvasRef.current.toBlob(this.uploadImage.bind(this));\n    }\n  }, {\n    key: \"saveImage\",\n    value: function saveImage() {\n      this.setState({\n        stream: this.state.stream,\n        camera: this.state.camera,\n        fullscreen: this.state.fullscreen,\n        processedImage: this.state.processedImage,\n        filePrefix: this.state.processedImage,\n        status: STATUS.FILL_FORM\n      });\n    }\n  }, {\n    key: \"takeShot\",\n    value: function takeShot() {\n      this.shotsound.play();\n      var context = this.canvasRef.current.getContext('2d');\n      this.canvasRef.current.width = this.videoRef.current.videoWidth;\n      this.canvasRef.current.height = this.videoRef.current.videoHeight;\n      context.drawImage(this.videoRef.current, 0, 0, this.canvasRef.current.width, this.canvasRef.current.height);\n      this.setState({\n        stream: this.state.stream,\n        camera: this.state.camera,\n        fullscreen: this.state.fullscreen,\n        processedImage: this.state.processedImage,\n        filePrefix: this.state.filePrefix,\n        status: STATUS.KEEP_IMAGE_USER_DECISION\n      });\n    }\n  }, {\n    key: \"startCapturingWebCam\",\n    value: function startCapturingWebCam() {\n      var _this3 = this;\n\n      console.log('Check device camera capabilities');\n      navigator.mediaDevices.enumerateDevices().then(function (deviceInfos) {\n        return _this3.gotDevices(deviceInfos);\n      }).catch(function (e) {\n        return alert(\"enumerateDevices() error: \".concat(e.name));\n      });\n    }\n  }, {\n    key: \"gotDevices\",\n    value: function gotDevices(deviceInfos) {\n      var _this4 = this;\n\n      var numberOfCameras = 0;\n\n      for (var i = 0; i !== deviceInfos.length; ++i) {\n        var deviceInfo = deviceInfos[i];\n        var option = document.createElement('option');\n        option.value = deviceInfo.deviceId;\n\n        if (deviceInfo.kind === 'videoinput') {\n          numberOfCameras++;\n          console.log('Find Camera named ' + deviceInfo.label);\n        }\n      }\n\n      var cameraStatus = CAMERA.SINGLE;\n      var newStatus = this.state.status;\n\n      switch (numberOfCameras) {\n        case 0:\n          newStatus = STATUS.NO_CAMERA_DETECTED;\n          console.error('This device have no camera');\n          break;\n\n        case 1:\n          cameraStatus = CAMERA.SINGLE;\n          break;\n\n        case 2:\n          cameraStatus = CAMERA.FRONT;\n          break;\n\n        default:\n          cameraStatus = CAMERA.FRONT;\n          console.warning('Only the first two camera are used');\n          break;\n      }\n\n      if (newStatus !== STATUS.NO_CAMERA_DETECTED) {\n        console.log('Requesting webcam access');\n        var constraints = {\n          audio: false,\n          video: true\n        };\n        navigator.mediaDevices.getUserMedia(constraints).then(function (stream) {\n          return _this4.displayWebcamOutput(stream);\n        }).catch(function (e) {\n          return alert(\"getUserMedia() error: \".concat(e.name));\n        });\n      }\n\n      this.setState({\n        stream: this.state.stream,\n        camera: cameraStatus,\n        fullscreen: this.state.fullscreen,\n        processedImage: this.state.processedImage,\n        filePrefix: this.state.filePrefix,\n        status: newStatus\n      });\n    }\n  }, {\n    key: \"displayWebcamOutput\",\n    value: function displayWebcamOutput(webcamStream) {\n      console.log('Put stream on video HTML component');\n      this.videoRef.current.srcObject = webcamStream;\n      message.warning('Take a clear picture of your face, mouth open, tongue outside.', 4);\n      this.setState({\n        stream: webcamStream,\n        camera: this.state.camera,\n        fullscreen: this.state.fullscreen,\n        processedImage: this.state.processedImage,\n        filePrefix: this.state.filePrefix,\n        status: STATUS.TAKE_SHOT\n      });\n    }\n  }, {\n    key: \"canvasStyle\",\n    value: function canvasStyle() {\n      switch (this.state.status) {\n        case STATUS.KEEP_IMAGE_USER_DECISION:\n        case STATUS.IMAGE_DOWNLOADED:\n          return {\n            display: \"block\"\n          };\n\n        default:\n          return {\n            display: \"none\"\n          };\n      }\n    }\n  }, {\n    key: \"videoStyle\",\n    value: function videoStyle() {\n      switch (this.state.status) {\n        case STATUS.TAKE_SHOT:\n          return {\n            display: \"block\"\n          };\n\n        default:\n          return {\n            display: \"none\"\n          };\n      }\n    }\n  }, {\n    key: \"displayNewDiag\",\n    value: function displayNewDiag() {\n      switch (this.state.status) {\n        case STATUS.DISPLAY_BAD_RESULT:\n        case STATUS.DISPLAY_GOOD_RESULT:\n          return true;\n\n        default:\n          return false;\n      }\n    }\n  }, {\n    key: \"displayClose\",\n    value: function displayClose() {\n      switch (this.state.status) {\n        case STATUS.IMAGE_SENT_CONFIRMATION:\n        case STATUS.IMAGE_DOWNLOADED:\n        case STATUS.BACKEND_TIMEOUT:\n          return true;\n\n        default:\n          return false;\n      }\n    }\n  }, {\n    key: \"displayError\",\n    value: function displayError() {\n      switch (this.state.status) {\n        case STATUS.NO_CAMERA_DETECTED:\n        case STATUS.BACKEND_TIMEOUT:\n          return true;\n\n        default:\n          return false;\n      }\n    }\n  }, {\n    key: \"openFullscreen\",\n    value: function openFullscreen() {\n      if (this.containerRef.current.requestFullscreen) {\n        this.containerRef.current.requestFullscreen();\n      } else if (this.containerRef.current.mozRequestFullScreen) {\n        /* Firefox */\n        this.containerRef.current.mozRequestFullScreen();\n      } else if (this.videoRef.current.webkitRequestFullscreen) {\n        /* Chrome, Safari & Opera */\n        this.containerRef.current.webkitRequestFullscreen();\n      } else if (this.videoRef.current.msRequestFullscreen) {\n        /* IE/Edge */\n        this.containerRef.current.msRequestFullscreen();\n      }\n\n      this.setState({\n        stream: this.state.stream,\n        camera: this.state.camera,\n        fullscreen: true,\n        processedImage: this.state.processedImage,\n        filePrefix: this.state.filePrefix,\n        status: this.state.status\n      });\n    }\n  }, {\n    key: \"exitFullscreen\",\n    value: function exitFullscreen() {\n      if (document.exitFullscreen) {\n        document.exitFullscreen();\n      } else if (document.mozCancelFullScreen) {\n        /* Firefox */\n        document.mozCancelFullScreen();\n      } else if (document.webkitExitFullscreen) {\n        /* Chrome, Safari and Opera */\n        document.webkitExitFullscreen();\n      } else if (document.msExitFullscreen) {\n        /* IE/Edge */\n        document.msExitFullscreen();\n      }\n\n      this.setState({\n        stream: this.state.stream,\n        camera: this.state.camera,\n        fullscreen: false,\n        processedImage: this.state.processedImage,\n        filePrefix: this.state.filePrefix,\n        status: this.state.status\n      });\n    }\n  }, {\n    key: \"changeActiveCamera\",\n    value: function changeActiveCamera() {\n      var _this5 = this;\n\n      console.log('Switch camera');\n      var constraints = {\n        audio: false,\n        video: {\n          deviceId: this.state.camera === CAMERA.FRONT ? {\n            exact: 0\n          } : {\n            exact: 1\n          }\n        }\n      };\n      this.state.stream.close();\n      this.setState({\n        stream: null,\n        camera: this.state.camera === CAMERA.FRONT ? CAMERA.REAR : CAMERA.FRONT,\n        fullscreen: this.state.fullscreen,\n        processedImage: this.state.processedImage,\n        filePrefix: this.state.filePrefix,\n        status: this.state.status\n      });\n      navigator.mediaDevices.getUserMedia(constraints).then(function (stream) {\n        return _this5.displayWebcamOutput(stream);\n      }).catch(function (e) {\n        return alert(\"getUserMedia() error: \".concat(e.name));\n      });\n    }\n  }, {\n    key: \"rotateImageLeft\",\n    value: function rotateImageLeft() {\n      console.log('rotate image to the left');\n    }\n  }, {\n    key: \"rotateImageRight\",\n    value: function rotateImageRight() {\n      console.log('rotate image to the right');\n    }\n  }, {\n    key: \"sendByEmail\",\n    value: function sendByEmail() {\n      console.log('Send by email');\n      this.setState({\n        stream: this.state.stream,\n        camera: this.state.camera,\n        fullscreen: this.state.fullscreen,\n        processedImage: this.state.processedImage,\n        filePrefix: this.state.filePrefix,\n        status: STATUS.IMAGE_SENT_CONFIRMATION\n      });\n    }\n  }, {\n    key: \"downloadImage\",\n    value: function downloadImage() {\n      console.log('Download image');\n      this.setState({\n        stream: this.state.stream,\n        camera: this.state.camera,\n        fullscreen: this.state.fullscreen,\n        processedImage: this.state.processedImage,\n        filePrefix: this.state.filePrefix,\n        status: STATUS.IMAGE_DOWNLOADED\n      });\n      this.saveBase64AsFile(this.state.processedImage, \"ReInvent-this.state-\" + this.state.filePrefix + \".png\");\n    }\n  }, {\n    key: \"saveBase64AsFile\",\n    value: function saveBase64AsFile(base64, fileName) {\n      var link = document.createElement(\"a\");\n      link.setAttribute(\"href\", base64);\n      link.setAttribute(\"download\", fileName);\n      link.click();\n    }\n  }, {\n    key: \"backendTimedOut\",\n    value: function backendTimedOut() {\n      console.log(\"Backend timed out\");\n      this.processound.pause();\n      this.setState({\n        stream: this.state.stream,\n        camera: this.state.camera,\n        fullscreen: this.state.fullscreen,\n        processedImage: null,\n        filePrefix: \"\",\n        status: STATUS.BACKEND_TIMEOUT\n      });\n    }\n  }, {\n    key: \"fetchImage\",\n    value: function fetchImage() {\n      var _this6 = this;\n\n      //Storage.get(UPLOAD_S3_PREFIX + '/' + this.state.filePrefix + '.json', { download: true })\n      Storage.get(UPLOAD_S3_PREFIX + '/' + this.state.filePrefix + '.png-UserData.json', {\n        download: true\n      }).then(function (result) {\n        _this6.gotResultFromBackend(JSON.parse(result.Body.toString('utf-8')));\n      }).catch(function (err) {\n        console.log(\"Backend haven't finish\");\n        console.log(err);\n        _this6.waittime += 2000;\n\n        if (_this6.waittime < APPLICATION_TIMEOUT) {\n          console.log(\"Launch S3 get again, time = \" + _this6.waittime);\n          setTimeout(_this6.fetchImage.bind(_this6), 2000);\n        } else {\n          _this6.backendTimedOut();\n        }\n      });\n    }\n  }, {\n    key: \"waitForImageFromBackend\",\n    value: function waitForImageFromBackend() {\n      console.log('Wait for image');\n      this.waittime = 0;\n      this.fetchImage();\n    }\n  }, {\n    key: \"gotResultFromBackend\",\n    value: function gotResultFromBackend(result) {\n      console.log('Got A RESULT from backend');\n      this.processound.pause();\n      var i;\n      var gotAFace = false;\n      var isSick = false;\n\n      if (typeof result.Labels !== 'undefined' && result.Labels.length > 0) {\n        for (i = 0; i < result.Labels.length; i++) {\n          console.log('========= ITEM ==========');\n          console.log(result.Labels[i]);\n          console.log(result.Labels[i].Name);\n          console.log(result.Labels[i].Confidence);\n          console.log('=========================');\n\n          if (result.Labels[i].Name === \"Person\" && result.Labels[i].Confidence >= 95) {\n            gotAFace = true;\n            var random = Math.random();\n            console.log('random =' + random);\n            isSick = random >= 0.75;\n            console.log('isSick =' + isSick);\n            break;\n          }\n        }\n      }\n\n      var nextStatus = STATUS.DISPLAY_GOOD_RESULT;\n\n      if (!gotAFace) {\n        nextStatus = STATUS.NO_FACE_DETECTED;\n      } else {\n        if (isSick) {\n          nextStatus = STATUS.DISPLAY_BAD_RESULT;\n        }\n      }\n\n      console.log('nextStatus =' + nextStatus);\n      this.setState({\n        stream: this.state.stream,\n        camera: this.state.camera,\n        fullscreen: this.state.fullscreen,\n        processedImage: result,\n        filePrefix: this.state.filePrefix,\n        status: nextStatus\n      });\n      console.log(result);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this7 = this;\n\n      return React.createElement(\"div\", {\n        ref: this.containerRef,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 468\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"Welcome\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 469\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        className: \"logo\",\n        src: \"octank.png\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 469\n        },\n        __self: this\n      }), \" GFS\"), React.createElement(Progress, {\n        status: this.state.status,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 470\n        },\n        __self: this\n      }), this.state.status === STATUS.TAKE_SHOT && React.createElement(Button, {\n        className: \"camera\",\n        type: \"primary\",\n        onClick: function onClick() {\n          return _this7.takeShot();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 472\n        },\n        __self: this\n      }, \"Take picture\"), this.state.status === STATUS.KEEP_IMAGE_USER_DECISION && React.createElement(Button, {\n        className: \"camera\",\n        type: \"primary\",\n        onClick: function onClick() {\n          return _this7.saveImage();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 473\n        },\n        __self: this\n      }, \"Keep this image\"), this.state.status === STATUS.KEEP_IMAGE_USER_DECISION && React.createElement(Button, {\n        className: \"camera\",\n        onClick: function onClick() {\n          return _this7.ignoreImage();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 474\n        },\n        __self: this\n      }, \"Delete image\"), React.createElement(\"div\", {\n        className: \"video-container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 476\n        },\n        __self: this\n      }, React.createElement(\"video\", {\n        style: this.videoStyle(),\n        ref: this.videoRef,\n        muted: true,\n        autoPlay: true,\n        playsInline: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 477\n        },\n        __self: this\n      }), React.createElement(\"canvas\", {\n        style: this.canvasStyle(),\n        ref: this.canvasRef,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 478\n        },\n        __self: this\n      })), this.displayError() && React.createElement(\"i\", {\n        className: \"material-icons deco\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 481\n        },\n        __self: this\n      }, \"mood_bad\"), this.state.status === STATUS.NO_CAMERA_DETECTED && React.createElement(\"h1\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 482\n        },\n        __self: this\n      }, \"Oh no, it looks that you have no camera\"), this.state.status === STATUS.BACKEND_TIMEOUT && React.createElement(\"h1\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 483\n        },\n        __self: this\n      }, \"Oh no, backend times out\"), this.displayClose() && React.createElement(\"button\", {\n        className: \"btn btn-pos-3l\",\n        onClick: function onClick() {\n          return _this7.returnToCapture();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 485\n        },\n        __self: this\n      }, React.createElement(\"i\", {\n        className: \"material-icons\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 485\n        },\n        __self: this\n      }, \"close\")), this.state.status === STATUS.FILL_FORM && React.createElement(MedicalForm, {\n        callback: function callback() {\n          return _this7.sendDataToBackend();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 487\n        },\n        __self: this\n      }), this.state.status === STATUS.NO_FACE_DETECTED && React.createElement(\"i\", {\n        className: \"material-icons deco_sad\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 490\n        },\n        __self: this\n      }, \"mood_bad\"), this.state.status === STATUS.NO_FACE_DETECTED && React.createElement(Alert, {\n        className: \"marginleft\",\n        message: \"Diagnostic Image Failure\",\n        description: \"We were not able to detect your face. Please take a picture closer from the camera.\",\n        type: \"error\",\n        showIcon: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 491\n        },\n        __self: this\n      }), this.state.status === STATUS.NO_FACE_DETECTED && React.createElement(Button, {\n        className: \"marginleft\",\n        type: \"primary\",\n        onClick: function onClick() {\n          return _this7.returnToCapture();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 493\n        },\n        __self: this\n      }, \"Retry\"), this.displayNewDiag() && React.createElement(Button, {\n        className: \"marginleft\",\n        type: \"primary\",\n        onClick: function onClick() {\n          return _this7.returnToCapture();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 494\n        },\n        __self: this\n      }, \"New Disgnostic\"), this.state.status === STATUS.WAITING_FOR_PROCESSING && React.createElement(\"i\", {\n        className: \"material-icons deco rotate\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 496\n        },\n        __self: this\n      }, \"hourglass_empty\"), this.state.status === STATUS.WELCOME && React.createElement(Button, {\n        type: \"primary\",\n        onClick: function onClick() {\n          return _this7.startCapturingWebCam();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 499\n        },\n        __self: this\n      }, \"Start my diagnostic\"));\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport default App;","map":{"version":3,"sources":["/Users/ktshah/workspacek/mclinical/src/App.js"],"names":["React","Component","Amplify","Storage","message","Button","Icon","Alert","awsmobile","Progress","MedicalForm","configure","Logger","LOG_LEVEL","APPLICATION_TIMEOUT","UPLOAD_S3_PREFIX","DOWNLOAD_S3_PREFIX","STATUS","WELCOME","KEEP_IMAGE_USER_DECISION","TAKE_SHOT","LOADING","WAITING_FOR_PROCESSING","DISPLAY_GOOD_RESULT","DISPLAY_BAD_RESULT","NO_CAMERA_DETECTED","NO_FACE_DETECTED","IMAGE_DOWNLOADED","BACKEND_TIMEOUT","FILL_FORM","CAMERA","REAR","FRONT","SINGLE","App","waittime","videoRef","createRef","canvasRef","containerRef","sendsound","Audio","deletesound","shotsound","processound","addEventListener","currentTime","play","state","stream","camera","fullscreen","processedImage","filePrefix","status","level","returnToCapture","warning","setState","image","filename","Date","now","put","contentType","then","result","console","log","waitForImageFromBackend","catch","err","error","current","toBlob","uploadImage","bind","context","getContext","width","videoWidth","height","videoHeight","drawImage","navigator","mediaDevices","enumerateDevices","deviceInfos","gotDevices","e","alert","name","numberOfCameras","i","length","deviceInfo","option","document","createElement","value","deviceId","kind","label","cameraStatus","newStatus","constraints","audio","video","getUserMedia","displayWebcamOutput","webcamStream","srcObject","display","IMAGE_SENT_CONFIRMATION","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen","exitFullscreen","mozCancelFullScreen","webkitExitFullscreen","msExitFullscreen","exact","close","saveBase64AsFile","base64","fileName","link","setAttribute","click","pause","get","download","gotResultFromBackend","JSON","parse","Body","toString","setTimeout","fetchImage","backendTimedOut","gotAFace","isSick","Labels","Name","Confidence","random","Math","nextStatus","takeShot","saveImage","ignoreImage","videoStyle","canvasStyle","displayError","displayClose","sendDataToBackend","displayNewDiag","startCapturingWebCam"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport Amplify, { Storage } from 'aws-amplify';\nimport { message, Button, Icon, Alert } from 'antd';\nimport awsmobile from './aws-exports';\nimport Progress from './component/Progress';\n//import BadResult from './component/BadResult';\n//import GoodResult from './component/GoodResult';\n\nimport MedicalForm from './component/MedicalForm';\nimport './App.css';\nAmplify.configure(awsmobile);\nAmplify.Logger.LOG_LEVEL = 'INFO';\n\nconst APPLICATION_TIMEOUT = 8000; // In milliseconds\nconst UPLOAD_S3_PREFIX = \"uploads\";\nconst DOWNLOAD_S3_PREFIX = \"results\";\n\nconst STATUS = {\n  WELCOME: \"Welcome page\",\n  KEEP_IMAGE_USER_DECISION: \"Keep image user decision\",\n  TAKE_SHOT: \"Take shot\",\n  LOADING: \"Loading\",\n  WAITING_FOR_PROCESSING: \"Wait image to be processed\",\n  DISPLAY_GOOD_RESULT: \"Display good news\",\n  DISPLAY_BAD_RESULT: \"Display bad news\",\n  NO_CAMERA_DETECTED: \"No camera on device\",\n  NO_FACE_DETECTED: \"No face detected\",\n  IMAGE_DOWNLOADED: \"Result image was downloaded by user\",\n  BACKEND_TIMEOUT: \"Backend was too long to answer\",\n  FILL_FORM: \"User is filling the form\"\n}\n\n\nconst CAMERA = {\n  REAR: \"rear cam\",\n  FRONT: \"front cam\",\n  SINGLE: \"there is only one cam\"\n}\n\nclass App extends Component {\n\n  constructor(){\n    super();\n    this.waittime = 0;\n    this.videoRef = React.createRef();\n    this.canvasRef = React.createRef();\n    this.containerRef = React.createRef();\n    this.sendsound = new Audio(\"/sounds/send.mp3\");\n    this.deletesound = new Audio(\"/sounds/trash.mp3\");\n    this.shotsound = new Audio(\"/sounds/takeshot.mp3\");\n    this.processound = new Audio(\"/sounds/processing.mp3\");\n    this.processound.addEventListener('ended', function() {\n        this.currentTime = 0;\n        this.play();\n    }, false);\n\n    this.state = {\n      stream: null,\n      camera: CAMERA.SINGLE,\n      fullscreen: false,\n      processedImage: null,\n      filePrefix: \"\",\n      status: STATUS.WELCOME\n    }\n  }\n\n  componentDidMount(){\n    Storage.configure({ level: 'private' });\n  }\n\n\n\n  ignoreImage() {\n    this.deletesound.play();\n    this.returnToCapture();\n  }\n\n  returnToCapture() {\n    message.warning('Take a clear picture of your face, mouth open, tongue outside.', 2);\n    this.setState(\n    {\n      stream: this.state.stream,\n      camera: this.state.camera,\n      fullscreen: this.state.fullscreen,\n      processedImage: this.state.processedImage,\n      filePrefix: this.state.filePrefix,\n      status: STATUS.TAKE_SHOT\n    });\n  }\n\n  uploadImage(image) {\n    var filename = Date.now();\n    Storage.put(UPLOAD_S3_PREFIX + '/' + filename + '.png', image, { contentType: 'image/png' })\n    .then (result => {\n      console.log(\"upload done\");\n      this.setState(\n      {\n        stream: this.state.stream,\n        camera: this.state.camera,\n        fullscreen: this.state.fullscreen,\n        processedImage: this.state.processedImage,\n        filePrefix: filename,\n        status: this.state.status\n      });\n      this.waitForImageFromBackend();\n    })\n    .catch(err => console.error(err));\n\n  }\n\n  sendDataToBackend() {\n    this.processound.play();\n    this.setState(\n    {\n      stream: this.state.stream,\n      camera: this.state.camera,\n      fullscreen: this.state.fullscreen,\n      processedImage: this.state.processedImage,\n      filePrefix: this.state.processedImage,\n      status: STATUS.WAITING_FOR_PROCESSING\n    });\n    this.canvasRef.current.toBlob(this.uploadImage.bind(this));\n  }\n  saveImage() {\n\n    this.setState(\n    {\n      stream: this.state.stream,\n      camera: this.state.camera,\n      fullscreen: this.state.fullscreen,\n      processedImage: this.state.processedImage,\n      filePrefix: this.state.processedImage,\n      status: STATUS.FILL_FORM\n    });\n  }\n\n  takeShot() {\n    this.shotsound.play()\n    var context = this.canvasRef.current.getContext('2d');\n    this.canvasRef.current.width = this.videoRef.current.videoWidth;\n    this.canvasRef.current.height = this.videoRef.current.videoHeight;\n    context.drawImage(this.videoRef.current, 0, 0, this.canvasRef.current.width, this.canvasRef.current.height);\n    this.setState(\n    {\n      stream: this.state.stream,\n      camera: this.state.camera,\n      fullscreen: this.state.fullscreen,\n      processedImage: this.state.processedImage,\n      filePrefix: this.state.filePrefix,\n      status: STATUS.KEEP_IMAGE_USER_DECISION\n    });\n  }\n\n  startCapturingWebCam() {\n    console.log('Check device camera capabilities');\n\n    navigator.mediaDevices.enumerateDevices()\n    .then(deviceInfos => this.gotDevices(deviceInfos))\n    .catch(e => alert(`enumerateDevices() error: ${e.name}`));\n  }\n\n  gotDevices(deviceInfos) {\n    var numberOfCameras = 0;\n    for (var i = 0; i !== deviceInfos.length; ++i) {\n      var deviceInfo = deviceInfos[i];\n\n      var option = document.createElement('option');\n      option.value = deviceInfo.deviceId;\n\n      if (deviceInfo.kind === 'videoinput') {\n        numberOfCameras++;\n        console.log('Find Camera named ' + deviceInfo.label);\n      }\n    }\n\n    var cameraStatus = CAMERA.SINGLE;\n    var newStatus = this.state.status;\n    switch(numberOfCameras) {\n      case 0:\n        newStatus = STATUS.NO_CAMERA_DETECTED;\n        console.error('This device have no camera');\n        break;\n      case 1:\n        cameraStatus = CAMERA.SINGLE;\n        break;\n      case 2:\n        cameraStatus = CAMERA.FRONT;\n        break;\n      default:\n        cameraStatus = CAMERA.FRONT;\n        console.warning('Only the first two camera are used');\n        break;\n    }\n    if(newStatus !== STATUS.NO_CAMERA_DETECTED) {\n      console.log('Requesting webcam access');\n      const constraints = {\n        audio: false,\n        video: true\n      };\n      navigator.mediaDevices.getUserMedia(constraints)\n      .then(stream => this.displayWebcamOutput(stream))\n      .catch(e => alert(`getUserMedia() error: ${e.name}`));\n    }\n\n    this.setState(\n    {\n      stream: this.state.stream,\n      camera: cameraStatus,\n      fullscreen: this.state.fullscreen,\n      processedImage: this.state.processedImage,\n      filePrefix: this.state.filePrefix,\n      status: newStatus\n    });\n  }\n\n  displayWebcamOutput(webcamStream) {\n    console.log('Put stream on video HTML component');\n    this.videoRef.current.srcObject = webcamStream;\n    message.warning('Take a clear picture of your face, mouth open, tongue outside.', 4);\n    this.setState(\n    {\n      stream: webcamStream,\n      camera: this.state.camera,\n      fullscreen: this.state.fullscreen,\n      processedImage: this.state.processedImage,\n      filePrefix: this.state.filePrefix,\n      status: STATUS.TAKE_SHOT\n    });\n  }\n\n  canvasStyle() {\n    switch (this.state.status) {\n      case STATUS.KEEP_IMAGE_USER_DECISION:\n      case STATUS.IMAGE_DOWNLOADED:\n        return {display: \"block\"};\n      default:\n        return {display: \"none\"};\n    }\n  }\n  videoStyle() {\n    switch (this.state.status) {\n      case STATUS.TAKE_SHOT:\n        return {display: \"block\"};\n      default:\n        return {display: \"none\"};\n    }\n  }\n  displayNewDiag() {\n    switch (this.state.status) {\n      case STATUS.DISPLAY_BAD_RESULT:\n      case STATUS.DISPLAY_GOOD_RESULT:\n        return true;\n      default:\n        return false;\n    }\n  }\n  displayClose() {\n    switch (this.state.status) {\n      case STATUS.IMAGE_SENT_CONFIRMATION:\n      case STATUS.IMAGE_DOWNLOADED:\n      case STATUS.BACKEND_TIMEOUT:\n        return true;\n      default:\n        return false;\n    }\n  }\n  displayError() {\n    switch (this.state.status) {\n      case STATUS.NO_CAMERA_DETECTED:\n      case STATUS.BACKEND_TIMEOUT:\n        return true;\n      default:\n        return false;\n    }\n  }\n\n  openFullscreen() {\n    if (this.containerRef.current.requestFullscreen) {\n      this.containerRef.current.requestFullscreen();\n    } else if (this.containerRef.current.mozRequestFullScreen) { /* Firefox */\n      this.containerRef.current.mozRequestFullScreen();\n    } else if (this.videoRef.current.webkitRequestFullscreen) { /* Chrome, Safari & Opera */\n      this.containerRef.current.webkitRequestFullscreen();\n    } else if (this.videoRef.current.msRequestFullscreen) { /* IE/Edge */\n      this.containerRef.current.msRequestFullscreen();\n    }\n    this.setState(\n    {\n      stream: this.state.stream,\n      camera: this.state.camera,\n      fullscreen: true,\n      processedImage: this.state.processedImage,\n      filePrefix: this.state.filePrefix,\n      status: this.state.status\n    });\n  }\n\n  exitFullscreen() {\n    if (document.exitFullscreen) {\n      document.exitFullscreen();\n    } else if (document.mozCancelFullScreen) { /* Firefox */\n      document.mozCancelFullScreen();\n    } else if (document.webkitExitFullscreen) { /* Chrome, Safari and Opera */\n      document.webkitExitFullscreen();\n    } else if (document.msExitFullscreen) { /* IE/Edge */\n      document.msExitFullscreen();\n    }\n\n    this.setState(\n    {\n      stream: this.state.stream,\n      camera: this.state.camera,\n      fullscreen: false,\n      processedImage: this.state.processedImage,\n      filePrefix: this.state.filePrefix,\n      status: this.state.status\n    });\n  }\n\n  changeActiveCamera() {\n    console.log('Switch camera');\n    const constraints = {\n      audio: false,\n      video: {deviceId: this.state.camera === CAMERA.FRONT ? {exact: 0} : {exact: 1}}\n    };\n    this.state.stream.close ();\n    this.setState(\n    {\n      stream: null,\n      camera: this.state.camera === CAMERA.FRONT ? CAMERA.REAR : CAMERA.FRONT,\n      fullscreen: this.state.fullscreen,\n      processedImage: this.state.processedImage,\n      filePrefix: this.state.filePrefix,\n      status: this.state.status\n    });\n    navigator.mediaDevices.getUserMedia(constraints)\n    .then(stream => this.displayWebcamOutput(stream))\n    .catch(e => alert(`getUserMedia() error: ${e.name}`));\n  }\n\n  rotateImageLeft() {\n    console.log('rotate image to the left');\n  }\n  rotateImageRight() {\n    console.log('rotate image to the right');\n  }\n  sendByEmail() {\n    console.log('Send by email');\n    this.setState(\n    {\n      stream: this.state.stream,\n      camera: this.state.camera,\n      fullscreen: this.state.fullscreen,\n      processedImage: this.state.processedImage,\n      filePrefix: this.state.filePrefix,\n      status: STATUS.IMAGE_SENT_CONFIRMATION\n    });\n  }\n  downloadImage() {\n    console.log('Download image');\n    this.setState(\n    {\n      stream: this.state.stream,\n      camera: this.state.camera,\n      fullscreen: this.state.fullscreen,\n      processedImage: this.state.processedImage,\n      filePrefix: this.state.filePrefix,\n      status: STATUS.IMAGE_DOWNLOADED\n    });\n    this.saveBase64AsFile(this.state.processedImage, \"ReInvent-this.state-\" + this.state.filePrefix + \".png\");\n  }\n\n  saveBase64AsFile(base64, fileName) {\n      var link = document.createElement(\"a\");\n      link.setAttribute(\"href\", base64);\n      link.setAttribute(\"download\", fileName);\n      link.click();\n  }\n\n  backendTimedOut() {\n    console.log(\"Backend timed out\");\n    this.processound.pause();\n    this.setState(\n    {\n      stream: this.state.stream,\n      camera: this.state.camera,\n      fullscreen: this.state.fullscreen,\n      processedImage: null,\n      filePrefix: \"\",\n      status: STATUS.BACKEND_TIMEOUT\n    });\n  }\n\n  fetchImage() {\n    //Storage.get(UPLOAD_S3_PREFIX + '/' + this.state.filePrefix + '.json', { download: true })\n    Storage.get(UPLOAD_S3_PREFIX + '/' + this.state.filePrefix + '.png-UserData.json', { download: true })\n    .then (result => {\n        this.gotResultFromBackend(JSON.parse(result.Body.toString('utf-8')));\n    })\n    .catch(err => {\n      console.log(\"Backend haven't finish\");\n      console.log(err);\n      this.waittime += 2000;\n      if(this.waittime < APPLICATION_TIMEOUT) {\n        console.log(\"Launch S3 get again, time = \" + this.waittime);\n        setTimeout(this.fetchImage.bind(this), 2000);\n      } else {\n        this.backendTimedOut();\n      }\n    });\n  }\n  waitForImageFromBackend() {\n    console.log('Wait for image');\n    this.waittime = 0;\n    this.fetchImage();\n  }\n  gotResultFromBackend(result) {\n    console.log('Got A RESULT from backend');\n    this.processound.pause();\n\n    var i;\n    var gotAFace = false;\n    var isSick = false;\n    if (typeof result.Labels !== 'undefined' && result.Labels.length > 0) {\n      for (i = 0; i < result.Labels.length; i++) {\n          console.log('========= ITEM ==========');\n          console.log(result.Labels[i]);\n          console.log(result.Labels[i].Name);\n          console.log(result.Labels[i].Confidence);\n              console.log('=========================');\n          if((result.Labels[i].Name === \"Person\") && (result.Labels[i].Confidence >= 95)) {\n            gotAFace = true;\n            var random = Math.random();\n            console.log('random ='+ random);\n            isSick = random >= 0.75;\n            console.log('isSick ='+ isSick);\n            break;\n          }\n      }\n    }\n\n    var nextStatus = STATUS.DISPLAY_GOOD_RESULT;\n    if(!gotAFace) {\n      nextStatus = STATUS.NO_FACE_DETECTED;\n    } else {\n      if(isSick) {\n        nextStatus = STATUS.DISPLAY_BAD_RESULT;\n      }\n    }\n\n    console.log('nextStatus ='+ nextStatus);\n\n    this.setState(\n    {\n      stream: this.state.stream,\n      camera: this.state.camera,\n      fullscreen: this.state.fullscreen,\n      processedImage: result,\n      filePrefix: this.state.filePrefix,\n      status: nextStatus\n    });\n\n    console.log(result);\n  }\n\n  render() {\n    return (\n      <div ref={this.containerRef}>\n        <div className=\"Welcome\"><img className=\"logo\" src=\"octank.png\" /> GFS</div>\n        <Progress status={this.state.status}/>\n\n        {this.state.status === STATUS.TAKE_SHOT && <Button className=\"camera\" type=\"primary\" onClick={() => this.takeShot()}>Take picture</Button> }\n        {this.state.status === STATUS.KEEP_IMAGE_USER_DECISION && <Button className=\"camera\" type=\"primary\" onClick={() => this.saveImage()}>Keep this image</Button> }\n        {this.state.status === STATUS.KEEP_IMAGE_USER_DECISION && <Button className=\"camera\" onClick={() => this.ignoreImage()}>Delete image</Button> }\n\n        <div className=\"video-container\">\n          <video style={this.videoStyle()} ref={this.videoRef} muted autoPlay playsInline/>\n          <canvas style={this.canvasStyle()} ref={this.canvasRef} />\n        </div>\n\n        {this.displayError() && <i className=\"material-icons deco\">mood_bad</i> }\n        {this.state.status === STATUS.NO_CAMERA_DETECTED && <h1>Oh no, it looks that you have no camera</h1> }\n        {this.state.status === STATUS.BACKEND_TIMEOUT && <h1>Oh no, backend times out</h1> }\n\n        {this.displayClose() && <button className=\"btn btn-pos-3l\" onClick={() => this.returnToCapture()}><i className=\"material-icons\">close</i></button> }\n\n        {this.state.status === STATUS.FILL_FORM && <MedicalForm callback={() => this.sendDataToBackend()} /> }\n        \n\n        {this.state.status === STATUS.NO_FACE_DETECTED && <i className=\"material-icons deco_sad\">mood_bad</i> }\n        {this.state.status === STATUS.NO_FACE_DETECTED && <Alert className=\"marginleft\" message=\"Diagnostic Image Failure\" description=\"We were not able to detect your face. Please take a picture closer from the camera.\" type=\"error\" showIcon /> }\n\n        {this.state.status === STATUS.NO_FACE_DETECTED && <Button className=\"marginleft\" type=\"primary\" onClick={() => this.returnToCapture()}>Retry</Button> }\n        {this.displayNewDiag() && <Button className=\"marginleft\" type=\"primary\" onClick={() => this.returnToCapture()}>New Disgnostic</Button> }\n\n        {this.state.status === STATUS.WAITING_FOR_PROCESSING && <i className=\"material-icons deco rotate\">hourglass_empty</i> }\n\n\n        {this.state.status === STATUS.WELCOME && <Button type=\"primary\" onClick={() => this.startCapturingWebCam()}>Start my diagnostic</Button> }\n\n      </div>\n    );\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}